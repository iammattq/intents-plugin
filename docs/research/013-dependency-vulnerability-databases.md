# Dependency Vulnerability Databases & APIs

Research on open security knowledge bases that can be queried for dependency vulnerabilities.

## Overview

Modern software relies heavily on open source dependencies. A DevOps security agent needs access to vulnerability databases to identify security issues in these dependencies. This document covers the major open databases, their APIs, and how to integrate them.

---

## 1. OSV.dev (Open Source Vulnerabilities)

**URL**: https://osv.dev/
**Source**: Google (Open Source Security Foundation)
**Cost**: Free & Open Source

### Key Features
- **Aggregator**: Combines vulnerabilities from GitHub Security Advisories, PyPA, RustSec, Global Security Database, and more
- **Precise version mapping**: Maps vulnerabilities to specific package versions and commits (unlike NVD which often lacks version specificity)
- **OpenSSF OSV Schema**: Standardized, machine-readable format

### Supported Ecosystems
- **JavaScript/Node**: npm
- **Python**: PyPI
- **Go**: Go modules
- **Rust**: crates.io
- **Java**: Maven
- **Ruby**: RubyGems
- **PHP**: Packagist
- **.NET**: NuGet
- **Linux**: Debian, Ubuntu, Alpine, AlmaLinux, Rocky
- **Others**: Hex (Elixir), Pub (Dart), CRAN (R), SwiftURL

### API Usage

**Query by package**:
```bash
curl -X POST -d '{"package": {"name": "lodash", "ecosystem": "npm"}}' \
  "https://api.osv.dev/v1/query"
```

**Query by version**:
```bash
curl -X POST -d '{"package": {"name": "lodash", "ecosystem": "npm"}, "version": "4.17.20"}' \
  "https://api.osv.dev/v1/query"
```

**Batch query**:
```bash
curl -X POST -d '{"queries": [{"package": {"name": "lodash", "ecosystem": "npm"}, "version": "4.17.20"}]}' \
  "https://api.osv.dev/v1/querybatch"
```

### OSV-Scanner CLI
```bash
# Install
go install github.com/google/osv-scanner/cmd/osv-scanner@latest

# Scan lockfile
osv-scanner --lockfile=package-lock.json

# Scan directory
osv-scanner -r /path/to/project

# JSON output for automation
osv-scanner --format json --lockfile=package-lock.json
```

### Data Download
Full database available at: `gs://osv-vulnerabilities/all.zip`

---

## 2. GitHub Advisory Database

**URL**: https://github.com/advisories
**Source**: GitHub/Microsoft
**Cost**: Free

### Key Features
- **Powers npm audit**: Direct integration with npm CLI
- **Curated**: Security team reviews and enriches advisories
- **Ecosystem-specific**: Advisories tagged by package manager

### API Access

**GraphQL API** (requires token):
```graphql
query {
  securityAdvisories(first: 10, ecosystem: NPM) {
    nodes {
      ghsaId
      summary
      severity
      vulnerabilities(first: 5) {
        nodes {
          package { name ecosystem }
          vulnerableVersionRange
          firstPatchedVersion { identifier }
        }
      }
    }
  }
}
```

**Via npm audit protocol**:
```bash
# Standard audit
npm audit

# JSON output
npm audit --json

# Production only
npm audit --omit=dev
```

**Via pnpm**:
```bash
pnpm audit
pnpm audit --json
```

---

## 3. National Vulnerability Database (NVD)

**URL**: https://nvd.nist.gov/
**Source**: NIST (US Government)
**Cost**: Free

### Key Features
- **CVE Authority**: Official CVE numbering and descriptions
- **CVSS Scores**: Standardized severity scoring
- **Wide coverage**: Not limited to open source

### Limitations
- Often lacks version-specific information
- Can have delays in enrichment data
- Higher false positive rate for dependency scanning

### API Access
```bash
# Search by keyword
curl "https://services.nvd.nist.gov/rest/json/cves/2.0?keywordSearch=lodash"

# By CVE ID
curl "https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=CVE-2021-23337"
```

---

## 4. Snyk Vulnerability Database

**URL**: https://security.snyk.io/
**Source**: Snyk (Commercial)
**Cost**: Free tier available, paid for advanced features

### Key Features
- **More vulnerabilities**: Often includes issues before other databases
- **Fix recommendations**: Suggests upgrade paths
- **License scanning**: Identifies license compliance issues

### CLI Usage
```bash
# Install
npm install -g snyk

# Authenticate
snyk auth

# Test project
snyk test

# JSON output
snyk test --json

# Monitor for new vulnerabilities
snyk monitor
```

---

## 5. Package Manager Built-in Tools

### npm
```bash
npm audit                    # Interactive report
npm audit --json             # Machine-readable
npm audit fix                # Auto-fix where possible
npm audit fix --force        # Force major version updates
```

### pnpm
```bash
pnpm audit                   # Audit report
pnpm audit --json            # JSON output
pnpm audit --fix             # Auto-fix
```

### yarn
```bash
yarn audit                   # v1
yarn npm audit               # v2+
```

### pip (Python)
```bash
pip-audit                    # Via pip-audit package
safety check                 # Via safety package
```

### cargo (Rust)
```bash
cargo audit                  # Via cargo-audit
```

### bundler (Ruby)
```bash
bundle audit                 # Via bundler-audit gem
```

---

## 6. CVE Binary Tool

**URL**: https://github.com/intel/cve-bin-tool
**Source**: Intel (Open Source)
**Cost**: Free & Open Source

### Key Features
- Scans binaries, not just lockfiles
- Uses NVD, OSV, GitLab Advisory Database, RedHat
- Generates SBOMs

```bash
pip install cve-bin-tool
cve-bin-tool /path/to/project
cve-bin-tool --sbom-type spdx --sbom-output sbom.json /path/to/project
```

---

## Comparison Matrix

| Database | API | Free | Ecosystems | Version Precision | Update Frequency |
|----------|-----|------|------------|-------------------|------------------|
| OSV.dev | REST | ✅ | 20+ | Excellent | Continuous |
| GitHub Advisory | GraphQL + npm | ✅ | 6 | Good | Continuous |
| NVD | REST | ✅ | All | Limited | Daily |
| Snyk | REST | Freemium | 10+ | Excellent | Continuous |

---

## Agent Integration Strategy

For a dependency security agent, the recommended approach is:

### Primary: OSV.dev
- Free, open source, no rate limits
- Best version-to-vulnerability mapping
- Covers all major ecosystems
- CLI tool (osv-scanner) works offline with downloaded database

### Secondary: Package Manager Audits
- `npm audit` / `pnpm audit` for Node.js
- `pip-audit` for Python
- These use GitHub Advisory Database under the hood

### Enrichment: NVD
- For CVSS scores and additional context
- For CVEs not yet in OSV

### Workflow

```
1. Detect dependency files (package.json, requirements.txt, Cargo.toml, etc.)
2. Run OSV-Scanner for comprehensive vulnerability check
3. Run ecosystem-specific audit (npm audit, pip-audit, etc.)
4. Cross-reference with NVD for severity scores if needed
5. Generate report with:
   - Vulnerable packages
   - Severity levels
   - Fixed versions available
   - Upgrade paths
   - Breaking change warnings
```

---

## API Rate Limits

| Service | Rate Limit | Auth Required |
|---------|------------|---------------|
| OSV.dev | Generous (unspecified) | No |
| GitHub Advisory | 5000/hr with token | Yes for GraphQL |
| NVD | 5 requests/30sec (no key), 50/30sec (with key) | Optional |
| Snyk | Varies by plan | Yes |

---

## Output Schema (OSV Format)

```json
{
  "id": "GHSA-xxxx-xxxx-xxxx",
  "summary": "Prototype Pollution in lodash",
  "details": "...",
  "severity": [{"type": "CVSS_V3", "score": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H"}],
  "affected": [{
    "package": {"ecosystem": "npm", "name": "lodash"},
    "ranges": [{
      "type": "SEMVER",
      "events": [
        {"introduced": "0"},
        {"fixed": "4.17.21"}
      ]
    }]
  }],
  "references": [{"type": "ADVISORY", "url": "..."}]
}
```

---

## Sources

- [OSV.dev](https://osv.dev/)
- [OSV GitHub Repository](https://github.com/google/osv.dev)
- [OSV Schema Documentation](https://ossf.github.io/osv-schema/)
- [GitHub Advisory Database powers npm audit](https://github.blog/security/supply-chain-security/github-advisory-database-now-powers-npm-audit/)
- [npm audit documentation](https://docs.npmjs.com/cli/v8/commands/npm-audit/)
- [Snyk Vulnerability Database](https://security.snyk.io/)
- [GitGuardian: Open Source Vulnerability Databases Comparison](https://blog.gitguardian.com/open-source-vulnerability-databases-comparison/)
- [Aikido: Top Open Source Dependency Scanners](https://www.aikido.dev/blog/top-open-source-dependency-scanners)
